<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.104.3"><meta name=description content><link rel=icon href=/images/favicon.png type=image/png><title>Windows.NTFS.Timestomp :: Velociraptor - Digging deeper!</title><link href=/css/nucleus.css?1666623084 rel=stylesheet><link href=/css/fontawesome-all.min.css?1666623084 rel=stylesheet><link href=/css/featherlight.min.css?1666623084 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1666623084 rel=stylesheet><link href=/css/auto-complete.css?1666623084 rel=stylesheet><link href=/css/theme.css?1666623084 rel=stylesheet><link href=/css/tabs.css?1666623084 rel=stylesheet><link href=/css/hugo-theme.css?1666623084 rel=stylesheet><link href=/css/theme-mine.css?1666623084 rel=stylesheet><link href=/css/dark.css?1666623084 rel=stylesheet><link href=/css/syntax.css?1666623084 rel=stylesheet><link href=/css/light.css?1666623084 rel=stylesheet><link href=/css/hljs.css?1666623084 rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css?1666623084 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1666623084></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYH72LMYCS"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYH72LMYCS",{anonymize_ip:!1})}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-QYH72LMYCS","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script></script></head><body data-url=/exchange/artifacts/pages/timestomp/><nav id=sidebar><div id=header-wrapper><div id=header><script>function darkmode(){$("body").addClass("dark").removeClass("light"),document.cookie="theme=darkmode;path=/"}function lightmode(){$("body").removeClass("dark").addClass("light"),document.cookie="theme=lightmode;path=/"}const regex=new RegExp("theme=darkmode");regex.test(document.cookie)?darkmode():lightmode()</script><div class="btn btn-default ThemeSelector darkmode" onclick=darkmode()><i class="fas fa-moon"></i></div><div class="btn btn-default ThemeSelector lightmode" onclick=lightmode()><i class="fas fa-sun"></i></div><a href=https://docs.velociraptor.app/><img src=https://docs.velociraptor.app//images/logo.svg></a></div></div><div class=highlightable><ul class=topics><li data-nav-id=https://docs.velociraptor.app/docs/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/><i class="fas fa-book-reader"></i>Documentation</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/overview/>Velociraptor Overview</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/history/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/history/>History</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/support/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/support/>Support Policy</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/deployment/>Deployment</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/deployment/self-signed/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/self-signed/>Self-Signed SSL</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/cloud/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/deployment/cloud/>Cloud Deployment</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/deployment/cloud/multifrontend/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/cloud/multifrontend/>Multi-Frontend</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/clients/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/clients/>Deploying Clients</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/rbac/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/rbac/>Users and Roles</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/resources/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/resources/>Performance</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/troubleshooting/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/troubleshooting/>Troubleshooting</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/gui/>The Admin GUI</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/gui/clients/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/clients/>Inspecting clients</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/vfs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/vfs/>The VFS</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/artifacts/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/artifacts/>Artifacts</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/hunting/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/hunting/>Hunting</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/vql/>VQL Fundamentals</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/vql/notebooks/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/notebooks/>Notebooks</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/artifacts/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/artifacts/>Artifacts</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/events/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/events/>Event Queries</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/forensic/>Forensic Analysis</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/forensic/filesystem/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/filesystem/>Searching Filenames</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/searching/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/searching/>Searching Content</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/ntfs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/ntfs/>NTFS Analysis</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/binary/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/binary/>Binary parsing</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/evidence_of_execution/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/evidence_of_execution/>Evidence Of Execution</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/event_logs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/event_logs/>Event Logs</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/volatile/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/volatile/>Volatile State</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/offline_triage/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/offline_triage/>Triage and acquisition</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/client_monitoring/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/client_monitoring/>Client Monitoring</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/extending_vql/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/extending_vql/>Extending VQL</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/server_automation/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/server_automation/>Server Automation</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/server_automation/server_api/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/server_api/>Server API</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/server_automation/server_monitoring/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/server_monitoring/>Server Monitoring</a></div></li></ul></li></ul></li><hr><li data-nav-id=https://docs.velociraptor.app/vql_reference/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/vql_reference/><i class="fas fa-book"></i>VQL Reference</a></div><ul><li data-nav-id=https://docs.velociraptor.app/vql_reference/basic/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/basic/>Basic VQL</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/linux/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/linux/>Linux Specific</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/windows/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/windows/>Windows Specific</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/parsers/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/parsers/>Parsers</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/server/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/server/>Server Side</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/plugin/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/plugin/>Client Side</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/event/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/event/>Event Plugins</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/experimental/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/experimental/>Experimental</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/misc/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/misc/>Misc</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/training/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/training/><i class="fas fa-graduation-cap"></i>Training</a></div></li><li data-nav-id=https://docs.velociraptor.app/blog/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/blog/><i class="fas fa-newspaper"></i>Blog</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/presentations/><i class="fas fa-chalkboard-teacher"></i>Presentations</a></div><ul><li data-nav-id=https://docs.velociraptor.app/presentations/2022_linuxconf_au/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_linuxconf_au/>Linux Conf Au 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_auscert/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_auscert/>Auscert 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_dfrws_us/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_dfrws_us/>DFRWS US 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_tech_user_group_cbr/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_tech_user_group_cbr/>Tech Users Group 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_sans_summit/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_sans_summit/>SANS Summit 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_velocon/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_velocon/>Velocon 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_dfrws_apac/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_dfrws_apac/>DFRWS APAC 2022</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/exchange/ class="dd-item parent haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/exchange/><i class="fas fa-code"></i>Artifact Exchange</a></div></li><li data-nav-id=https://docs.velociraptor.app/artifact_references/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/artifact_references/><i class="fas fa-book"></i>Artifact Reference</a></div></li><li data-nav-id=https://docs.velociraptor.app/knowledge_base/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/knowledge_base/><i class="fas fa-brain"></i>Knowledge Base</a></div></li><li data-nav-id=https://docs.velociraptor.app/search/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/search/><i class='fas fa-search'></i>Search</a></div></li></ul><hr><section id=shortcuts><h3></h3><ul><li><a class=padding href=https://github.com/Velocidex/velociraptor><i class='fab fa-github'></i>Github</a></li><li><a class=padding href=https://docs.velociraptor.app/discord/><i class='fab fa-discord'></i>Discord</a></li><li><a class=padding href=mailto:velociraptor-discuss@googlegroups.com><i class='fas fa-envelope'></i>Mailing List</a></li><li><a class=padding href=https://docs.velociraptor.app/rss/><i class='fas fa-rss'></i>RSS</a></li></ul></section><section id=footer><div class=footer-copyright>Brought to you by
<img src=/images/Rapid7_logo.svg class=rapid7><br><i class="fas fa-copyright"></i> 2022</div></section></div></nav><script>$("#sidebar i.fa-angle-right").each(function(){$(this).parent().parent().find("ul").hide()})</script><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title='Edit this page' href=https://github.com/Velocidex/velociraptor-docs/edit/master/content/exchange/artifacts/Timestomp.yaml target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Windows.NTFS.Timestomp</span></div><div class=progress><div class=wrapper><nav id=TableOfContents></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Windows.NTFS.Timestomp</h1><p>This artifact enables triage to detect potential time stomped files.</p><p>Checks:</p><ul><li>$STANDARD_INFORMATION “B” time prior to $FILE_NAME “B” time</li><li>$STANDARD_INFORMATION “B” or &ldquo;M&rdquo; time has nanosecond precision.</li><li>PE compile time prior to any $STANDARD_INFORMATION time stamp.</li></ul><p>Optional:</p><ul><li>$STANDARD_INFORMATION “M” time prior to ShimCache timestamp</li><li>$STANDARD_INFORMATION times prior to $I30 slack &ldquo;B&rdquo; or &ldquo;M&rdquo; times.</li><li>Full PE metadata output.</li></ul><p>Note: If an option is selected the artifact will also output additional metadata for context.</p><p>Available filters include:<br>PathRegex (OSPath): e.g ^C:\folder\file.ext$ or partial \folder\folder2\ or string|string2|string3<br>FileRegex: ^filename.ext$ or partial string1|string2</p><pre><code class=language-yaml>name: Windows.NTFS.Timestomp
author: &quot;Matt Green - @mgreen27&quot;
description: |
    This artifact enables triage to detect potential time stomped files.

    Checks:
    
    - $STANDARD_INFORMATION “B” time prior to $FILE_NAME “B” time
    - $STANDARD_INFORMATION “B” or &quot;M&quot; time has nanosecond precision. 
    - PE compile time prior to any $STANDARD_INFORMATION time stamp.  
    
    Optional:  
    
    - $STANDARD_INFORMATION “M” time prior to ShimCache timestamp
    - $STANDARD_INFORMATION times prior to $I30 slack &quot;B&quot; or &quot;M&quot; times.
    - Full PE metadata output.
    
    Note: If an option is selected the artifact will also output additional metadata for context.
    
    Available filters include:  
      PathRegex (OSPath): e.g ^C:\\folder\\file\.ext$ or partial \\folder\\folder2\\ or string|string2|string3  
      FileRegex: ^filename.ext$ or partial string1|string2  

    
parameters:
  - name: MFTDrive
    description: |
      The path to to the drive that holds the MFT file (can be a
      pathspec).
    default: &quot;C:&quot;
  - name: PathRegex
    description: &quot;Regex search over FullPath.&quot;
    default: &quot;.&quot;
  - name: FileRegex
    description: &quot;Regex search over FileName.&quot;
    default: &quot;.&quot;
    type: regex
  - name: UploadHits
    type: bool
    description: &quot;Upload complete complete attribute data.&quot;
  - name: ShimcacheTest
    type: bool
    description: &quot;If PE, check $STANDARD_INFORMATION “M” time prior to ShimCache timestamp&quot;
  - name: I30Test
    type: bool
    description: &quot;Check $STANDARD_INFORMATION times prior to $I30 slack B or M times.&quot;
  - name: OutputPEInfo
    type: bool
    description: &quot;Output full PE metadata information.&quot;

sources:
  - query: |
      -- find all MFT entries in scope
      LET mft_entries = SELECT *,OSPath,FileName,FileNames,EntryNumber,
            LastModified0x10,LastAccess0x10, LastRecordChange0x10,Created0x10, --SI used in test
            LastModified0x30,Created0x30, -- FN used in test
            IsDir,InUse,SI_Lt_FN,uSecZeros,
            parse_pe(file=OSPath) as PE,
            magic(path=OSPath) as Magic
        FROM Artifact.Windows.NTFS.MFT(MFTDrive=MFTDrive,PathRegex=PathRegex,FileRegex=FileRegex)
        --WHERE NOT IsDir
      
      -- if MZ files collect shimcache to compare modification time
      LET shimcache &lt;= SELECT * 
        FROM if(condition= ShimcacheTest,
            then= { SELECT Name, ModificationTime FROM Artifact.Windows.Registry.AppCompatCache() })
      LET shimcache_mtime(target) = SELECT Name, ModificationTime FROM shimcache 
        WHERE Name = target 
        ORDER BY ModificationTime
      
      LET i30 &lt;= SELECT * FROM if(condition= I30Test,
            then= { 
                SELECT * FROM foreach(
                    row={ 
                        SELECT dirname(path=OSPath) as Directory FROM mft_entries
                        GROUP BY Directory
                    },
                    query={
                        SELECT
                            split(sep_string='\\\\.\\',string=FullPath)[1] + '\\' + Name as FullPath,
                            IsSlack,MFTId,Mtime,Atime,Ctime,Btime
                        FROM Artifact.Windows.NTFS.I30(DirectoryGlobs=Directory,preconditions=True)
                        WHERE MFTId OR FullPath
                    })
            })
      LET find_i30_slack(inode,folder,filenames,mtime,ctime,slackcheck) = SELECT * FROM i30 
        WHERE MFTId = str(str=inode) OR ( split(sep_string='''\\.\''',string=FullPath)[1] = folder AND Name in filenames) 
            AND if(condition= slackcheck,
                then= ( Mtime &gt; mtime OR Btime &gt; btime ) AND IsSlack,
                else= True )
                
      LET base_results = SELECT 
            OSPath,
            dict(Created0x10=Created0x10,Created0x30=Created0x30) as CreatedTimestamps,
            InUse,
            SI_Lt_FN as `SI&lt;FN`,uSecZeros,
            if(condition=PE.FileHeader.TimeDateStamp,
                then= if(condition= LastModified0x10 &lt; PE.FileHeader.TimeDateStamp OR LastAccess0x10 &lt; PE.FileHeader.TimeDateStamp OR LastRecordChange0x10 &lt; PE.FileHeader.TimeDateStamp OR Created0x10 &lt; PE.FileHeader.TimeDateStamp,
                        then= True,
                        else= False),
                else= 'N/A') as SuspiciousCompileTime,
            parse_ntfs(mft=EntryNumber, device=MFTDrive ) as NtfsMetadata,
            Magic,
            if(condition=PE, then=PE,else='N/A') as PE,
            Created0x10,LastModified0x10,FileNames,EntryNumber,
            if(condition= Magic=~'^PE' AND NOT Magic =~ '\(DLL\)',
                then= if(condition= LastModified0x10 &lt; shimcache_mtime(target=str(str=OSPath))[0].ModificationTime,
                    then= True,
                    else= False),
                else= 'N/A') as SuspiciousShimcache,
            if(condition= Magic=~'^PE' AND NOT Magic =~ '\(DLL\)',
                then= shimcache_mtime(target=str(str=OSPath))[0],
                else= 'N/A') as Shimcache,
            if(condition = find_i30_slack(inode=EntryNumber,folder=dirname(path=OSPath),filenames=FileNames,mtime=LastModified0x10,ctime=Created0x10,slackcheck=True),
                then= True,
                else= False ) as SuspiciousI30,
            find_i30_slack(inode=EntryNumber,folder=dirname(path=OSPath),filenames=FileNames,mtime=LastModified0x10,ctime=Created0x10,slackcheck=False) as I30
      FROM mft_entries
      
      LET results = SELECT * FROM if(condition= ShimcacheTest AND I30Test AND OutputPEInfo,
            then={
                SELECT 
                    OSPath,CreatedTimestamps,InUse,
                    `SI&lt;FN`,uSecZeros,
                    SuspiciousCompileTime,
                    SuspiciousShimcache,
                    SuspiciousI30,
                    NtfsMetadata,
                    Magic,
                    Shimcache,
                    I30,
                    PE
                FROM base_results
            },
            else= if(condition= ShimcacheTest AND I30Test,
                then={
                SELECT 
                    OSPath,CreatedTimestamps,InUse,
                    `SI&lt;FN`,uSecZeros,
                    SuspiciousCompileTime,
                    SuspiciousShimcache,
                    SuspiciousI30,
                    NtfsMetadata,
                    Magic,
                    Shimcache,
                    I30
                FROM base_results
            },
            else= if(condition= ShimcacheTest AND OutputPEInfo,
                then={
                    SELECT 
                    OSPath,CreatedTimestamps,InUse,
                    `SI&lt;FN`,uSecZeros,
                    SuspiciousCompileTime,
                    SuspiciousShimcache,
                    NtfsMetadata,
                    Magic,
                    Shimcache,
                    PE
                FROM base_results
            },
            else= if(condition= I30Test AND OutputPEInfo,
                then={
                    SELECT 
                    OSPath,CreatedTimestamps,InUse,
                    `SI&lt;FN`,uSecZeros,
                    SuspiciousCompileTime,
                    SuspiciousI30,
                    NtfsMetadata,
                    Magic,
                    I30,
                    PE
                FROM base_results
            },
            else= if(condition= ShimcacheTest,
                then={
                    SELECT 
                    OSPath,CreatedTimestamps,InUse,
                    `SI&lt;FN`,uSecZeros,
                    SuspiciousCompileTime,
                    SuspiciousShimcache,
                    NtfsMetadata,
                    Magic,
                    Shimcache
                FROM base_results
            },
            else= if(condition= I30Test,
                then={
                    SELECT 
                    OSPath,CreatedTimestamps,InUse,
                    `SI&lt;FN`,uSecZeros,
                    SuspiciousCompileTime,
                    SuspiciousI30,
                    NtfsMetadata,
                    Magic,
                    I30
                FROM base_results
            },
            else= if(condition= OutputPEInfo,
                then={
                    SELECT 
                    OSPath,CreatedTimestamps,InUse,
                    `SI&lt;FN`,uSecZeros,
                    SuspiciousCompileTime,
                    NtfsMetadata,
                    Magic,
                    PE
                FROM base_results
            },
                else={
                    SELECT 
                        OSPath,CreatedTimestamps,InUse,
                        `SI&lt;FN`,uSecZeros,
                        SuspiciousCompileTime,
                        NtfsMetadata,
                        Magic
                    FROM base_results
            })
            ))))))

      LET upload_results = SELECT *, upload(file=OSPath) as Upload FROM results
      
      SELECT * FROM if(condition= UploadHits,
        then= upload_results,
        else= results)

</code></pre><footer class=footline></footer></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//velocidex-velociraptor.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1666623085></script>
<script src=/js/perfect-scrollbar.min.js?1666623085></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1666623085></script>
<script src=/js/jquery.sticky.js?1666623085></script>
<script src=/js/featherlight.min.js?1666623085></script>
<script src=/js/highlight.min.js?1666623085></script>
<script>hljs.highlightAll()</script><script src=/js/modernizr.custom-3.6.0.js?1666623085></script>
<script src=/js/learn.js?1666623085></script>
<script src=/js/hugo-learn.js?1666623085></script></body></html>